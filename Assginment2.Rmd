---
title: "Er det høyde som bestemmer inntekt?"
output:
  pdf_document: default
  html_notebook: default
  html_document:
    df_print: paged
lang: no-NB
---


```{r}
library(ggplot2)
library(tinytex)
library(tidyverse)
library(modelr)
library(ggpubr)
library(huxtable)
library(car)
library(carData)
options(scipen = 999)
```

# Kort innledning

Vi vil i denne oppgaven bruke datasettet ***heights*** for å undersøke
riktigheten av påstanden om at høyde bestemmer inntekt. Undersøkelsen
vil bli gjort gjennom analyser av ulike variabler og ved
regresjonsanalyser. Resultatene vil bli fremstilt i ulike modeller, før
vi vil avslutte med en konklusjon av spørsmålet "er det høyde som
bestemmer inntekt?".

# Litteraturgjennomgang

# Analyse

```{r Hoyde}
hoyde <- heights
```

# Beskrivende statestikk

Datasettet 'Heights' som har fått navnet 'hoyde' består opprinnelig av åtte variabler og 7006 observasjoner. Basert på disse variablene og observasjonene skal det være mulig å konkludere om ens inntekt bestemmes av høyde. Variablene som er inkludert i datasettet er: 
* income - Basert på årlig inntekt, der topp to prosent er representert av gjennomsnittelig verdi av de to prosentene. 
* height - Høyden til subjektene som har deltatt målt i inch.
* weight - Vekten til subjektene som har deltatt målt i pounds.
* age - Alderen til subjektene som har deltatt er mellom 47 og 56.
* martial - Subjektenes sivilstatus, om der gift eller skilt. 
* sex - Subjektenes kjønn, mann eller kvinne. 
* education - Subjektenes år med utdanning. 
* afqt - Subjektenes poengsum i prosent på 'Armed Forces Qualification Test' 

# EDA

```{r}
ggplot(data = hoyde)
```


## Lag et histogram av variablen *income*

```{r}
ggplot(data = hoyde, aes(income)) +
  geom_histogram()
```

## Forklaringen på utliggerne langt til høyre

På modellen ser man at utliggeren som i dette tilfellet er ekstremalpunktet ligger langt til høyre. Dette er på grunn av at de har blitt regnet ut et gjennomsnitt av topp to prosentene av inntektene.  

## Personer uten inntekt inkludert i datasettet?

```{r}
sum(hoyde$income == 0)
```
Det er altså 1740 av 7006 personer som har null i inntekt.

# Regresjonsanalyse

```{r}
hoyde <- heights
```

## Dollar til norske kroner 

```{r}
hoyde <- hoyde %>% 
   mutate(inntekt = income * 8.42)

```
Vi gjør Amerikanske dollar om til norske kroner. Valutakurens ligger på 8.42.

## Redusert datasett

```{r}
hoyde_begr <- hoyde %>%  
  filter(inntekt < 1500000,
         inntekt > 1)
```

```{r}
ggplot(data = hoyde_begr, aes(income)) +
  geom_histogram()
```


## Lag to nye variabler + lag ny variabel "bmi"

```{r}
hoyde <- hoyde %>% 
  mutate(hoyde_cm = height * 2.54,
         vekt_kg = weight * 0.454,
         BMI = (vekt_kg/hoyde_cm)^2)
```

## Forenklet utgave av variabelen "Martial"

```{r}
hoyde <- hoyde %>% 
mutate(
  married = factor(
    case_when(
      marital == 'married' ~ TRUE,
      TRUE ~ FALSE
      )
    )
  )
```

# Minst 6 modeller


```{r}
model1 <- "inntekt ~ hoyde_cm"
lm1 <- lm(model1, data = hoyde, subset = complete.cases(hoyde)) 
summary(lm1)
```


```{r}
#trenger vi å ta med dette??
-1337837.4 + (9884.6 *173)
-1337837.4 + (9884.6 *161)
```


```{r}
Model2 <- "inntekt ~ hoyde_cm + vekt_kg" 
lm2 <- lm(Model2, data = hoyde, subset = complete.cases(hoyde))
summary(lm2)
```


```{r}
#Må vi ta med dette??
-697374.7 + (6735.7*173) + (-691.5*70)
```

```{r}
Model3 <- "inntekt ~ hoyde_cm + vekt_kg + BMI" 
lm3 <- lm(Model3, data = hoyde, subset = complete.cases(hoyde))
summary(lm3)
```


```{r}
# Slett denne
summary(hoyde_begr)
```

# Huxreg

```{r}
huxreg 
(list
  ("model1" = lm1, "model2" = lm2, "model3" = lm3),
       error format = "[{statistic}]",
       note = "Regresjonstabell 3: {stars}.T statistics in brackets."
)
```


# Interaksjon 

```{r}
# Riktig, fjern denne linjen.
Model4 <- "inntekt ~ sex*hoyde_cm + vekt_kg + I(vekt_kg^2) + BMI + I(BMI^2)"
lm4 <- lm(Model4, data = hoyde)
summary(lm4)
```

```{r}
Model5 <- "inntekt ~ sex*(hoyde_cm + vekt_kg + I(vekt_kg^2)) + BMI + I(BMI^2)"
lm5 <- lm(Model5, data = hoyde)
summary(lm4)
```

# Test av koeffisientene 

```{r}
linearHypothesis(lm4, c("sexfemale = 0", "sexfemale:hoyde_cm = 0"))
```

# Begrensing 

```{r}
Model6 <- "inntekt ~ sex*hoyde_cm + vekt_kg + I(vekt_kg^2) + BMI + I(BMI^2)"
lm6 <- lm(Model6, data = hoyde_begr)
summary(lm6)
```


# Legge til resiudalene til datasettet

```{r}
# Bruk verdiene fra begrenset datasett
hoyde_begr <- hoyde %>% 
  add_residuals(lm6)
hoyde_begr %>% 
  head(n=10)
```

# Plot av samtilige observasjoner

```{r}
ggplot(data = hoyde_begr, mapping = aes(x = hoyde_cm, y = inntekt)) +
  geom_point(
    data = hoyde_begr, 
    mapping = aes(x = hoyde_cm, y = resid),
    colour = "grey40",
    size = 0.3
    ) + 
  facet_grid(sex ~ factor(married, labels = c("not married", "married")))
```


# Konklusjon


